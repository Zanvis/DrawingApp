<div class="flex flex-col items-center">
    <canvas #canvas 
        class="w-full lg:h-[600px] h-[450px] border border-gray-300 mb-4"
        (mousedown)="onMouseDown($event)"
        (mousemove)="onMouseMove($event)"
        (mouseup)="onMouseUp($event)"
        (mouseleave)="onMouseUp($event)"
        (touchstart)="onTouchStart($event)"
        (touchmove)="onTouchMove($event)"
        (touchend)="onTouchEnd($event)"
        (touchcancel)="onTouchEnd($event)">
        (contextmenu)="onRightClick($event)">
    </canvas>
    <div *ngIf="showContextMenu" 
        [style.left.px]="contextMenuX" 
        [style.top.px]="contextMenuY" 
        class="absolute bg-white border border-gray-300 shadow-md rounded-md">
        <div *ngFor="let item of contextMenuItems" 
            (click)="item.action(); closeContextMenu()" 
            class="px-4 py-2 hover:bg-gray-100 cursor-pointer">
        {{ item.label }}
        <span *ngIf="item.shortcut" class="ml-2 text-gray-500 text-sm">{{ item.shortcut }}</span>
        </div>
    </div>
    <div class="flex flex-wrap space-x-2 mb-4">
        <button *ngFor="let color of predefinedColors" 
                [style.backgroundColor]="color"
                (click)="selectColor(color)"
                class="w-8 h-8 rounded-full border border-gray-300">
        </button>
        <input type="color" [(ngModel)]="currentColor" (change)="onColorPickerChange()" class="w-8 h-8">
        <button (click)="toggleEraser()" [class.bg-gray-300]="isEraser" class="px-4 py-2 border border-gray-300 rounded">Eraser</button>
        <input type="range" [(ngModel)]="brushSize" min="1" max="50" class="w-32">
        <span>Brush Size: {{brushSize}}</span>
    </div>
    <div class="flex space-x-2 mb-4">
        <button (click)="undo()" [disabled]="actions.length === 0" class="px-4 py-2 bg-blue-500 text-white rounded disabled:opacity-50">Undo</button>
        <button (click)="redo()" [disabled]="redoActions.length === 0" class="px-4 py-2 bg-green-500 text-white rounded disabled:opacity-50">Redo</button>
        <button (click)="clearCanvas()" class="px-4 py-2 bg-red-500 text-white rounded">Clear Canvas</button>
        <select (change)="changeBackground($event)" class="px-4 py-2 border border-gray-300 rounded">
            <option value="none">None</option>
            <option value="grid">Grid</option>
            <option value="lined">Lined</option>
        </select>
        <!-- <input type="file" (change)="handleImageUpload($event)" accept="image/*" class="px-4 py-2 border border-gray-300 rounded"> -->
        <button (click)="exportToPNG()" class="px-4 py-2 bg-blue-500 text-white rounded">Export PNG</button>
    </div>
    <input type="file" (change)="onFileSelected($event)" accept="image/*" class="px-4 py-2 mb-4 border border-gray-300 rounded">
</div>